<!-- macro -->

{% macro news_card(news_item, additional_classes='') %}
<div class="news-card {{ additional_classes}} relative overflow-hidden w-full v2">
  <img class="img-absolute-cover img-hover-scale xl:w-auto h-full xl:h-auto" style="border: 1px"
       src="{{ CMS_URL }}{{ news_item['attributes']['images']['data'][0]['attributes']['url'] }}"
       alt="Image" onerror="this.src='/assets/images/moov_square.svg';">
  <div class="cat-pasti absolute top-8 left-0">
    <span class="text-2xl px-3 py-3 my-3 inline-block sm:text-3xl">{{ category['name'] }}</span>
  </div>
  <a class="absolute bottom-0 left-0 w-full text-white bg-black bg-opacity-60 backdrop-filter backdrop-blur-sm px-4 py-4 sm:px-8 sm:py-8 news-card-link-container"
     href="{{ url_for('article.news_article', id=news_item['id'], slug=news_item['attributes']['slugId'], category=category['slug'], type=type['slug'] ) }}" >
    <h2 class="text-2xl mb-3 sm:text-4xl news-card-link-title">
      {{ news_item["attributes"]["title"] }}
    </h2>
    <div class="card-time top-border flex items-center text-xl">
      <span class="mr-4">
        {{ news_item["attributes"]["date"]|date }}
      </span>
      <span class="mr-4">
        {{ news_item["attributes"]["date"]|time }}
      </span>
      <span class="inline-flex items-center flex-nowrap popover-share" data-popover-target="#popover-target" onclick="return false;">
        <i class="fas fa-share-nodes"
           onclick="setLinkToShare(`{{ url_for('article.news_article', id=news_item['id'], slug=news_item['attributes']['slugId'], category=category['slug'], type=type['slug'] ) }}`)"></i>
        <!-- 130 -->
      </span>
    </div>
  </a>
</div>
{% endmacro %}

{% macro latest_news(additional_classes='') %}

<div class="relative bg-white shadow-md py-10 px-5 mt-12 mr-0 ml-0 mb-7 md:ml-0 {{additional_classes}}">
          <h2 class="block border-b-2 robotoslab text-5xl font-normal text-gray-600 pb-4 text-center md:text-left">Les
            derniers articles</h2>
          <div class="mini-card-v1 no-scrollbar">
            {% for news in result["data"] %}
            <a class="mini-card relative flex pb-4" href={{ url_for('article.news_article', id=news["id"], slug=news["attributes"]["slugId"], category=category['slug'], type=type['slug'] ) }}>
              <div class="relative overflow-hidden w-full md:w-2/5">
                <img class="img-absolute-cover img-hover-scale xl:w-auto h-full xl:h-auto"
                  src="{{ CMS_URL }}{{ news['attributes']['images']['data'][0]['attributes']['url'] }}" alt="Image"
                  onerror="this.src='/assets/images/moov_square.svg';">
              </div>
              <div class="relative w-full md:w-3/5">
                <div class="w-full text-gray-600 px-4 pb-3">
                  <h3 class="text-3xl mb-3">
                    {{ news["attributes"]["title"] }}
                  </h3>
                  <div class="card-time">
                    <span class="mr-4">
                      {{ news["attributes"]["date"]|date }}
                    </span>
                    <span class="mr-4">
                      {{ news["attributes"]["date"]|time }}
                    </span>
                    <span class=" inline-flex items-center flex-nowrap popover-share"
                      data-popover-target="#popover-target" onclick="return false;">
                      <i class="fas fa-share-nodes" onclick="setLinkToShare(`{{ url_for('article.news_article', id=news['id'],slug=news['attributes']['slugId'], category=category['slug'], type=type['slug'] ) }}`)"></i>

                      <!-- 130 -->
                    </span>
                  </div>
                </div>
              </div>
            </a>
            {% endfor %}
          </div>
          <div
            class="flex justify-center items-center absolute bottom-0 left-0 h-22 text-center bg-black bg-opacity-60 backdrop-filter backdrop-blur-sm w-full cursor-pointer">
            <img class="h-20 mx-5 py-5" src="/assets/images/arrow-down.svg">
          </div>
        </div>
{% endmacro %}


{% macro ads_inside_bar(ads , additional_classes='') %}
  <div class="{{additional_classes}}">
    <div
      class="w-full slider-element relative sj-slide sj-slide-full sj-slide-auto sj-slide-5s sj-slide-fade no-arrows ">
      {% for ad in ads %}
      <div class="article-pub-slide pub-slide block-slide relative overflow-hidden">
        <div class="object-cover relative overflow-hidden  mr-0 ml-auto  lg:w-full">
          <a href="{{ad['url']}}" target="_blank"><img src="{{CMS_URL}}{{ad['image']}}" alt="Moov publicité"
              class="object-cover w-full" onerror="this.src='/assets/images/moov_square.svg';"></a>
        </div>

      </div>
  </div>

    {% endfor%}
  </div>

{% endmacro %}



<!-- end macro -->

{% extends 'base.html' %}
{% block meta %}
<meta name="description" content="Actualités">
{% endblock %}
{% block title %}{{category['name']}}{% endblock %}


{% block content %}
<main>
  <section class="pb-12">
    <div class="container flex flex-wrap mx-auto">
      <div class="px-5 py-5 bg-gray-100 2xl:px-10 w-full lg:w-2/3">
        <div class="breadcrumb flex justify-center md:justify-start">
          <ul class="list-none flex flex-nowrap flex-column">
            <li class="breadcrumb-item">
              <a href="{{ url_for('home.home') }}">Accueil </a>
            </li>
            <li class="breadcrumb-item">
              <a href="{{ url_for('news.news') }}">{{type['name']}}</a>
            </li>
            <li class="breadcrumb-item">
              <a href="{{ url_for('news.news') }}">{{category['name']}}</a>
            </li>
          </ul>
        </div>
        <div class="big-title flex items-center w-full pt-5 pb-9">
          <h2 class="title text-8xl sm:text-8xl text-center md:text-left w-full md:w-1/2 xl:w-1/3 md:text-6xl">{{category['name']}}</h2>
          <div class="line flex items-center hidden md:block w-1/2 xl:w-2/3">
            <div class="h-1 w-full bg-gray-400">
            </div>
          </div>
        </div>

        <div class="actus-grid grid gap-4 md:gap-8 3xl:gap-10 grid-cols-2 lg:grid-cols-3 xl:grid-cols-3">

        {% if result['data'] %}

          {% for i in range(result['data']|length) %}
            {% if i == 0 %}
              {{ news_card(result['data'][i], 'col-span-2 ') }}
              <div class="news-pub relative overflow-hidden w-full v2 hidden lg:visible">
                <a href="{{ ads['with_article'][0]['url'] }}" target="_blank">
                  <img class="img-absolute-contain" src="{{ CMS_URL }}{{ ads['with_article'][i // 4]['image'] }}"
                      alt="Moov publicité" onerror="this.src='/assets/images/moov_square.svg';">
                </a>
              </div>
            {% elif i > 0 and i < 4 %} <!-- 2-3-4 -->
              {{ news_card(result['data'][i] , '') }}
            {% elif i == 4 %}
              <div class="news-pub relative overflow-hidden w-full v2 hidden lg:visible">
                <a href="{{ ads['with_article'][1]['url'] }}" target="_blank">
                  <img class="img-absolute-contain" src="{{ CMS_URL }}{{ ads['with_article'][i // 4]['image'] }}"
                      alt="Moov publicité" onerror="this.src='/assets/images/moov_square.svg';">
                </a>
              </div>
              {{ news_card(result['data'][i], 'lg:col-span-2 ') }}
            {% elif i > 4 %} <!-- 6-7-8-9 -->

              {% if i == 5 %}
                {{ ads_inside_bar(ads['side_bar'][0]  , 'visible lg:hidden') }}
                {{ ads_inside_bar(ads['side_bar'][1]  , 'visible lg:hidden') }}
                {{ latest_news('visible lg:hidden col-span-2 ') }}
              {% endif %}

              {{ news_card(result['data'][i] , 'col-span-2 lg:col-span-1' if i == 5 else '') }}
            {% endif %}


          {% endfor %}

        {% endif %}

        </div>

        {% include 'includes/pagination.html' %}
      </div>
      <div class="actus-grid-side py-5 w-full lg:w-1/3 hidden lg:visible">

         <!-- side pub-slider -->

        {{ ads_inside_bar(ads['side_bar'][0] ) }}

        <!-- side pub-slider -->

        {{ latest_news() }}

        <!-- side pub-slider -->

        {{ ads_inside_bar(ads['side_bar'][1] ) }}

        <!-- side pub-slider -->

      </div>
    </div>
  </section>

  {% include 'includes/share-popover.html' %}

</main>
{% endblock %}
